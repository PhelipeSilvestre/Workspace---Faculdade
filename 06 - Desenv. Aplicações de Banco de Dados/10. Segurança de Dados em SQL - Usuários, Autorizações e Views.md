**Segurança de Dados em SQL: Usuários, Autorizações e Views**

INTRODUÇÃO

Segurança de dados é um tópico importante nos dias de hoje. Administradores de bancos de dados devem garantir que os dados sejam acessados apenas por pessoas e programas aplicativos autorizados. Os conceitos e recursos de segurança de dados em SQL dizem respeito unicamente ao acesso aos dados armazenados. Não é função dos SGBDR proteger a infraestrutura tecnológica (rede, servidores etc.) contra ataques e invasões.

Em SQL, segurança de dados é baseada em 3 conceitos:

  Usuários. São aqueles que utilizam o banco de dados. Qualquer ação sobre os objetos de um banco de dados (ver a seguir) tem associado um usuário. O RDBMS permite ou não ações dependendo do usuário responsável;
  
  Objetos do banco de dados. São os itens sobre os quais regras de segurança são aplicadas. Normalmente, regras de segurança são aplicadas a tabelas e views, porém podem ser estendidas a outros objetos como programas armazenados ou até a todo o banco de dados;
  
  Permissões (ou Privilégios ou Autorizações). Conjunto de ações que um usuário tem permissão para executar sobre um conjunto de objetos do banco de dados. As permissões mais comuns são relacionadas aos comandos SELECT, INSERT, UPDATE e DELETE aplicados a um conjunto de tabelas. Pode-se também estabelecer permissões para outros comandos, como CREATE, ALTER e DROP.


Um usuário é identificado através de seu user id e uma senha, mas a forma como isto é implementado varia de acordo com o SGBDR utilizado. A maioria dos SGBDR comerciais utiliza o conceito de sessão para identificar o usuário. Uma sessão é iniciada quando o usuário se conecta ao SGBDR, seja através de uma rede ou localmente, caso ambos estejam utilizando mesmo servidor, e termina quando a conexão é encerrada. No MySQL, por exemplo, antes de acessar o SGDBR, o front end MySQL Workbench solicita ao usuário seu user id e senha. Após o usuário se identificar, o programa se conecta ao SGDBR com as permissões do usuário em questão.[1]


CRIAÇÃO DE USUÁRIOS

Os scripts SQL para criação das tabelas utilizadas nos exemplos encontram-se nos materiais de apoio.[2]       

A forma de se criar usuários varia de acordo com o SGBDR. O comando CREATE USER do MySQL, com suas principais cláusulas, encontra-se abaixo:

![1679501623721-36xg6KFUpQ](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/8c181c01-0ea7-483e-94bd-e1287cef5d2e)


​A forma mais simples de se criar um novo usuário é mostrada abaixo. O usuário contabilidade com senha Troqueasenha123 é criado, porém sem qualquer autorização. O usuário não consegue criar esquemas ou tabelas.

![1679501659940-9BUFtXXciT](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/35289223-c54e-4e20-9373-55b986acfb2d)


Para atribuir autorizações ao usuário, deve-se utilizar o comando GRANT, mostrado mais adiante. Um cuidado: os principais SGDBR comerciais são sensíveis a letras maiúsculas e minúsculas (case sensitive) para nome de usuário e senha, mas não para nomes de objetos.


As demais cláusulas têm suas funções explicadas a seguir:

  DEFAULT ROLE – Atribui ao usuários os perfis relacionados (perfis serão apresentados mais adiante);
  
  REQUIRE – Determina que formas de autenticação serão utilizadas para o usuário. O padrão é NONE;
  
  WITH – Define as quotas de recursos atribuídas ao usuário. As quotas que podem ser definidas são: 

    MAX_QUERIES_PER_HOUR – Número máximo de consultas no período de uma hora;
    
    MAX_UPDATES_PER_HOUR – Número máximo de atualizações no período de uma hora;

    MAX_CONNECTIONS_PER_HOUR – Número máximo de conexões estabelecidas no período de uma hora;
    
    MAX_USER_CONNECTIONS – Número máximo de conexões simultâneas.


​A quota de cada recurso é um número inteiro e positivo. Os exemplos a seguir ilustram a utilização do comando CREATE USER:

![1679501742252-aBhlftQou5](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/842b9455-90fc-449f-a9d8-398b4927db90)

O primeiro comando cria o usuário joao@abc.com.br com senha ‘2020@’. O segundo, cria o usuário jose, com permissão de acesso local, sem uso de senha e com limitações no número de conexões simultâneas (1) e número máximo de consultas no período de uma hora (20).



ATRIBUIÇÃO DE AUTORIZAÇÕES

Autorizações permitem que usuários manipulem objetos e executem comandos SQL. O administrador do SGDBR possui o nível máximo de autorização, podendo atribuir ou alterar os privilégios de qualquer usuário. Na sua forma mais geral, o comando GRANT[3] atribui a usuários permissão para executar um conjunto de comandos sobre um conjunto de objetos:

![1679501880314-PNifE48Nrp](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/32a7f3f4-f0af-4002-b83b-3fe7a5069ac3)

O modificador ALL atribui ao usuário todas as autorizações disponíveis, podendo até atribuir GRANT ALL a outro usuário caso a cláusula WITH GRANT OPTION esteja presente. Para autorizar um conjunto de comandos no mesmo comando GRANT, devem-se separá-los por vírgulas. O que pode ser autorizado também depende do SGBDR utilizado. No MySQL existem algumas dezenas de opções. As mais comuns, presentes em todos os principais SGBDR, são: CREATE, ALTER, DROP, SELECT, INSERT, UPDATE e DELETE.

Para comandos que manipulam colunas (SELECT, ALTER TABLE, INSERT e UPDATE) é possível fornecer a lista de colunas que podem ser manipuladas.[4] A cláusula ON especifica para que objetos estão sendo dadas as autorizações, podendo ser TABLE, FUNCTION ou PROCEDURE. TABLE deve ser utilizada se as autorizações são para uma tabela apenas. Os dois últimos tipos referem-se à programação SQL e não serão vistos aqui. Finalmente, a cláusula TO especifica o usuário que recebe as autorizações.

Exemplos:

![1679501927318-tlWtTbebol](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/aa8fb165-e291-411b-aab5-f40ddb9e5d71)

O primeiro exemplo atribui ao usuario1 privilégios de consulta (SELECT) das colunas a1 e a2, da tabela a, do esquema X. No segundo, é dada autorização para execução dos 5 comandos listados em qualquer tabela do esquema X. No terceiro, atribuem-se privilégios de administrados ao usuário1, exceto para o comando GRANT ALL. Finalmente, no quarto exemplo, usuário1 pode apenas consultar a tabela a no esquema selecionado.[5]

O comando FLUSH PRIVILEGES faz com que o SGDBR leia as tabelas de sistema e recarregue todas as informações de autorizações, atribuindo-as aos respectivos usuários ativos. Recomenda-se o seu uso após os comandos GRANT e REVOKE.



CRIAÇÃO E ATRIBUIÇÃO DE PERFIS

Atribuir autorizações a cada novo usuário criado pode ser um trabalho repetitivo e sujeito a erros. Na maioria dos casos, os usuários cadastrados recebem conjuntos de autorizações que tendem a se repetir. A linguagem SQL permite que sejam criados e nomeados conjuntos de autorizações padrão, chamados de perfis (roles).  O comando CREATE ROLE cria perfis:

![1679501999853-L2bL9pzoO6](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/7a277b70-20a3-4b91-9926-54843aa8e78c)

​Em um mesmo comando, podem ser criados vários perfis, porém todos “nascem” vazios. O comando GRANT é utilizado para se atribuir autorizações a perfis existentes, bastando substituir o nome do usuário pelo nome do perfil. No exemplo abaixo, dois perfis são criados e suas respectivas autorizações são atribuídas a eles:

![1679502027352-ZOKAGtmrlO](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/cbbe938f-4f5f-4651-9b0e-0fa93e9d0ff4)

Os perfis criados podem ser atribuídos aos novos usuários:

![1679502058971-EzZMz7REYz](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/7fe658e8-980a-4a70-b08e-6e8d1ef79bfe)

A partir do momento em que joao@abc.com.br estabelecer uma conexão com o SGBDR, as autorizações definidas em UsuarioExterno passam a valer.

Perfis também podem ser atribuídos a usuários existentes. Assumindo que o usuário luiz@localhost já tenha sido criado:

![1679502085982-vZJt5iG2Ge](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/6d233566-28c7-454f-8306-fa7d87a5b59f)

O comando REVOKE revoga autorizações atribuídas ao usuário. Há duas formas para o comando: revogação de comandos e revogação de perfis. Os exemplos abaixo ilustram as duas formas:

![1679502107680-5gUQrAnSwK](https://github.com/PhelipeSilvestre/Workspace---Faculdade/assets/99892687/6a251cd0-59b6-4a05-ad36-ab25e951b5b0)












